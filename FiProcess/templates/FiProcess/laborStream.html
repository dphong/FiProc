<!DOCTYPE html>  
{% load bootstrap3  %} 
{% load staticfiles %} 
<html lang="en">  
<head>  
    <meta charset="utf-8">  
    <title>合肥师范学院劳务费报销</title>
    <meta name="description" content="">  
    <link rel="stylesheet" type="text/css" href="{% static 'FiProcess/bootstrap.min.css' %}" /> 
    <script type="text/javascript" src="{% static 'FiProcess/jquery-2.2.4.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'FiProcess/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'FiProcess/validator.js' %}"></script>
    <style type="text/css">
    </style>
    <script type="text/javascript">
    function text(i, value, type){
        var result = "<td><div class='form-group'>\
                    <input name='"+type+i+"' type='text' required ";
        if (value.length > 0){
            result += "value='" + value + "'";
        }
        return result + " class='form-control input-md'></div></td>\n";
    }
    function number(i, value, type){
        var result = "<td><div class='form-group'>\
                    <input name='"+type+i+"' type='text' required ";
        if (value.length > 0){
            result += "value='" + value + "'";
        }
        return result + "pattern='^[0-9]*$'  class='form-control input-md'></div></td>\n";
    }
    function amount(i, value, type){
        var result = "<td><div class='form-group'>\
                    <input name='"+type+i+"' type='text' required ";
        if (value.length > 0){
            result += "value='" + value + "'";
        }
        return result + " pattern='^[0-9.]*$' class='form-control input-md'></div></td>\n";
    }
    function departmentList(i, value){
        var result = "<td><div class='form-group'>\
                    <select class='form-control' name='dept"+i+"' required>\
                        <option value selected='selected'>------</option>";
        {% for item in departmentList %}
            result += "<option value='{{item.id}}'";
            if('{{item.id}}' == value){
                result += " selected='selected'";
            }
            result += ">{{item.name}}</option>";
        {% endfor %}
        result += "</select>";
        return result + "</div></td>\n";
    }
    function addPay(i, workId, dept, name, duty, card, bank, payAmount){
        $('#tab_pay').append('<tr id="addr'+i+'"></tr>');
        $('#addr'+i).html(
            "<td>"+ i +"</td>\n" + number(i, workId, 'workId') + departmentList(i, dept) + text(i, name, 'name') + text(i, duty, 'duty')
            + number(i, card, 'card') + text(i, bank, 'bank') + amount(i, payAmount, 'amount'));
        i++; 
        $('#streamForm').validator();
        return i++;
    }
    $(document).ready(function(){
        var i=1;
        $("#add_row").click(function(){
            i = addPay(i, '', '', '', '', '', '', '');
            $('#streamForm').validator();
        });
        $("#delete_row").click(function(){
            if(i>1){
                $("#addr"+(i-1)).html('');
                i--;
                $('#streamForm').validator();
            }
        });
    })
    </script>
</head>

<body>
    <div class="container" style="max-width:1200px">
    {% if errorMsg %}
        <div class="alert alert-danger">  
            <button type="button" class="close" data-dismiss="alert">×</button>  
                <h4>请更改下列错误信息后重新提交：</h4>
            {% for msg in errorMsg %}
                <h4>{{ msg }}</h4>  
            {% endfor %}
        </div>  
    {% endif %}
    <form id="streamForm" data-toggle="validator" role="form" class="form" action="" method="post" style="margin:20px 0px 0px 0px">
        {% csrf_token %}
        <div class="form-group">  
            <input name="laborStreamForm" type="submit" class="btn btn-primary" value="创建"></input>
        </div>
        <div class="well">
            <h3 align="center"><strong>合肥师范学院劳务费报销</strong></h3>
            <div class="row">
                <div class="form-group col-md-3">
                    {% bootstrap_field form.department %}
                </div>
                <div class="form-group col-md-3">
                    {% bootstrap_field form.name %}
                </div>
                <div class="form-group col-md-3">
                    {% bootstrap_field form.workId %}
                </div>
                <div class="form-group col-md-3">
                    {% bootstrap_field form.applyDate %}
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-3">
                    {% bootstrap_field form.supportDept %}
                </div>
                <div class="form-group col-md-9">
                    {% bootstrap_field form.projectName %}
                </div>
            </div>
            <div class="row">
                <div class="form-group col-md-3">
                    {% bootstrap_field form.projectLaborTime %}
                </div>
                <div class="form-group col-md-9">
                    {% bootstrap_field form.streamDescript %}
                </div>
            </div>
            <label for="tab_pay" class="control-label">劳务发放表</label>
            <table class="table table-bordered table-hover" id="tab_pay">
                <thead>
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">职员代码</th>
                        <th class="text-center col-md-2">部门</th>
                        <th class="text-center">姓名</th>
                        <th class="text-center">职务(职称)</th>
                        <th class="text-center col-md-3">工资卡号</th>
                        <th class="text-center col-md-2">开户行</th>
                        <th class="text-center">金额</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="row">
                <div class="col-md-1">
                    <a id="add_row" class="btn btn-default">增加一条记录</a>
                </div>
                <div class="col-md-9"></div>
                <div class="col-md-1">
                    <a id='delete_row' class="btn btn-default">删除一条记录</a>
                </div>
            </div>
        </div>
    </form>
    <a href={% url 'index' '' %} class="btn btn-large btn-default">返回</a>
    </div>
</body>
</html>
